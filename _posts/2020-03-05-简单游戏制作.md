---
layout:   post
title:    如何开发一个简单的游戏
subtitle: 以飞机游戏为例
date:     2020-03-05
author:   YXC
catalog:  true
tags:
    -java
    -game
---
## 制作常量类
```
public class Constant{ //窗口中用来 *保存多次使用并可能修改* 的数值
  static final int GAME_WIDTH = 600; //设置窗口宽
  static final int GAME_HEIGHT = 900; //设置窗口高
}
```
## 制作游戏窗口
```
public class GameFrame extends Frame{ //继承Frame类以便调用方法
  public void launchFrame(){ //制作游戏窗口方法
    setTitle("飞机大战"); //设置窗口标题
    setVisible(true); //窗口可见
    setSize(Constant.GAME_WIDTH, Constant.GAME_HEIGHT); //设置窗口大小
    setLocation(600, 10); //设置窗口位置
  }
  
  addWindowListener(new WindowAdapter(){ //增加 *关闭窗口监听* ，使点击右上角可关闭程序
     public void windowClosing(WindowEvent e){
      system.exit(0); //0表示正常结束
     }
  }）；
  
  public static void main(String[] args){ //程序入口
    GameFrame f = new GameFrame(); //生成对象
    f.launchFrame; //调用对象中的制作窗口方法
  }
}
```
## 制作GameUtil工具类
将辅助性的工具方法放入工具类中，方便反复调用
```
public class GameUtil{
  private GameUtil(){ //工具类应把构造器私有
  }
  
  public static Image getImage(String path){
    BufferedImage bi = null;
    try{
      URL u = GameUtil.class.getClassLoader().getResource(path); //获得程序运行类加载器，加载资源根目录，获得相对资源位置
      bi = ImageIO.read(u); //核心方法，帮助读取图片信息，并返回Image对象
    }catch(IOException e){
        e.printStackTrace();
    }
    return bi;
  }
}
```
## 画出图片
将图片放到src/images下面，并调用paint方法加载图片
```
Image planeImg = GameUtil.getImage("images/plane.jpg"); //将图片定义为成员变量
Image bgImg = GameUtil.getImage("images/bg.jpg");

public void paint(Graphics g){ //paint方法：画出窗口及内部内容.ps:系统自动调用；Graphics对象相当于画笔
  g.drawImage(bgImg, 0, 0, null); //画出背景图片
  g.drawImage(planeImg, 0, 0, null);
}

class PaintThread extends Thread{ //增加绘制窗口的线程类 *实现动画效果*.ps:这是个内部类
  public void run(){
    while(true){
      repaint();
      try{
        Thread.sleep(40); //每40ms画一次，即25帧
      }catch (InterruptedException e){
        e.printStackTrace();
      }
    }
  }
}
```
在launchFrame方法中增加启动重画线程代码
```
public void launchFrame(){
  new PaintThread（）.start(); //启动重画线程
}
```
## 增加双线程防止图片闪烁
> 双线程实现原理：
内存中创建和画布一致的缓冲区
在缓冲区上画图
将位图拷贝到当前画布上
释放内存缓冲区

代码放入GameFrame类中
```
private Image offScreenImage = null;

public void update(Graphics g){
  if(offScreenImage == null){
    offScreenImage = this.createImage(Constant.GAME_WIDTH, Constant.GAME_HEIGHT); 
  }
  Graphics gOff = offScreenImage.getGraphics();
  paint(gOff);
  g.drawImage(offScreenImage, 0, 0, null);
}
```
## 创建游戏中物体父类
将游戏中物体共有的属性方法放入父类中可以减少创建时的工作量，必要时重写方法即可
```
public class GameObject{
  Image img; //物体贴图
  int x, y; //物体坐标
  int speed; //物体移动速度
  int width, height; //物体大小
  
  public void drawMyself(Graphics g){ //画图方法
    g.drawImage(img, x, y, null); 
  }
  //定义三个构造器
  public GameObject(Image img, int x, int y){
    this.img = img;
    this.x = x;
    this.y = y;
    if(img!=null){
      this.width = img.getWidth(null); //传入图片大小
      this.height = img.getHeight(null);
    }
  }
  public GameObject(Image img, int x, int y, int speed, int width, int height){
    this.img = img;
    this.x = x;
    this.y = y;
    this.speed = speed;
    this.width = width;
    this.height = height;
  }
  public GameObject(){
  }
  
  public Rectangle getRect(){ //返回物体外切矩形，为下面的碰撞检测做准备
    return new Rectangle(x, y, width, height);
  }
}
```
## 增加键盘控制
```

```
## 构造飞机类
借助GameObject构造飞机类就简单了
```
public class Plane extends GameObject{
  boolean live = true; //飞机是否存活
  boolean left, up, right, down; //定义飞机飞行的四个方向
  public void drawMyself(Graphics g){
    super.drawMyself(g); //先调用父类的方法，不然重写方法父类方法的内容就没有了
    if(left){
      this.x -= speed; //当下达命令时，飞机做出相应操作
    }
    if(up){
      this.y -= speed;
    }
    if(right){
      this.x += speed;
    }
    if(down){
      this.y += speed;
    }
  }
  
  public Plane(Image img, int x, int y, int speed){ //重写构造器
    this.img = img;
    this.x = x;
    this.y = y;
    this.speed = speed;
    this.width = img.getWidth(null);
    this.height = img.getHeight(null);
  }
  
  public void addDirection(KeyEvent e){ //根据键盘反馈开启相应命令
    switch (e.getKeyCode()){ //括号里的是获取键盘Unicode码的方法
      case：KeyEvent.VK_LEFT: //键盘对应left的Unicode码
        left = true;
        break;
      case: KeyEvent.VK_UP:
        up = true;
        break;
      case: KeyEvent.VK_RIGHT:
        right = true;
        break;
      case: KeyEvent.VK_DOWN:
        down = true;
        break;
    }
  }  
  public void addDirection(KeyEvent e){ //根据键盘反馈关闭相应命令
  switch (e.getKeyCode()){ //括号里的是获取键盘Unicode码的方法
    case：KeyEvent.VK_LEFT: //键盘对应left的Unicode码
      left = false;
      break;
    case: KeyEvent.VK_UP:
      up = false;
      break;
    case: KeyEvent.VK_RIGHT:
      right = false;
      break;
    case: KeyEvent.VK_DOWN:
      down = false;
      break;
  }
}
```
在GameFrame类中生成飞机对象并画出
```
Plane plane = new Plane(planeImg, 200, 200); //生成飞机对象
public void paint(Graphics g){
  plane.drawMyself(g); //在paint方法中调用画出方法
}
```
